{"version":3,"sources":["lib/ProtocolLogic.ts"],"names":[],"mappings":"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","file":"lib/ProtocolLogic.js","sourcesContent":["// Enum NS\r\nimport {Enum as EnumNS} from \"./ServerStateEnum\";\r\nimport AbstractEnum = EnumNS.AbstractEnum;\r\n// Param NS\r\nimport {Param as ParamNS} from \"./ParamSignature\";\r\nimport IParamSignature = ParamNS.IParamSignature;\r\n\r\n/**\r\n * \r\n */\r\nexport namespace Protocol {\r\n\t/**\r\n\t * \r\n\t */\r\n\texport interface IProtocolLogic {\r\n\t\tresolve(protocol: Array<IParamSignature>): Array<IParamSignature>;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\texport abstract class AbstractProtocolLogic implements IProtocolLogic {\r\n\t\tprotected fields: Array<string|AbstractEnum>;\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>) {\r\n\t\t\tthis.fields = fields;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tpublic resolve(protocol: Array<IParamSignature>): Array<IParamSignature> { \r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\texport class Depends extends AbstractProtocolLogic {\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tpublic if(target: string, mustBe: AbstractEnum|string): IProtocolLogic;\r\n\t\tpublic if(...fields): IProtocolLogic;\r\n\t\tpublic if(...fields): IProtocolLogic {\r\n\t\t\tlet resolveRef = this.resolve;\r\n\t\t\tthis.resolve = (protocol: Array<IParamSignature>): Array<IParamSignature> => { \r\n\t\t\t\tfor (let param of protocol){\r\n\t\t\t\t\tif (param.name === fields[0] && param.payload === fields[1].toString()) {\r\n\t\t\t\t\t\treturn resolveRef.call(this, protocol);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn protocol;\r\n\t\t\t};\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tpublic ifNot(target: string, cantBe: AbstractEnum|string): IProtocolLogic;\r\n\t\tpublic ifNot(...fields): IProtocolLogic;\r\n\t\tpublic ifNot(...fields): IProtocolLogic {\r\n\t\t\tlet resolveRef = this.resolve;\r\n\t\t\tthis.resolve = (protocol: Array<IParamSignature>): Array<IParamSignature> => { \r\n\t\t\t\tfor (let param of protocol){\r\n\t\t\t\t\tif (param.name === fields[0] && param.payload === fields[1].toString()) {\r\n\t\t\t\t\t\treturn protocol;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn resolveRef.call(this, protocol);\r\n\t\t\t};\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tconstructor(dependant: string|AbstractEnum, dependee: string|AbstractEnum);\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>);\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>) {\r\n\t\t\tsuper(...fields);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tpublic resolve(protocol: Array<IParamSignature>): Array<IParamSignature> { \r\n\t\t\tlet valids: Array<IParamSignature> = protocol.filter((param) => param.resolved && param.name === this.fields[1]);\r\n\t\t\tif (valids.length === 1) {\r\n\t\t\t\treturn protocol;\r\n\t\t\t}else {\r\n\t\t\t\treturn protocol.map((param) => {\r\n\t\t\t\t\tif (param.name === this.fields[0]) {\r\n\t\t\t\t\t\tparam.payload = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn param;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\texport class OneOf extends AbstractProtocolLogic {\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tconstructor(either: string|AbstractEnum, or: string|AbstractEnum);\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>);\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>) {\r\n\t\t\tsuper(...fields);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tpublic resolve(protocol: Array<IParamSignature>): Array<IParamSignature> { \r\n\t\t\tlet valids: Array<IParamSignature> = protocol.filter((param) => param.resolved && this.fields.indexOf(param.name) > -1);\r\n\t\t\tif (valids.length === 1) {\r\n\t\t\t\treturn protocol;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\texport class Coupled extends AbstractProtocolLogic {\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tconstructor(partnerA: string|AbstractEnum, partnerB: string|AbstractEnum);\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>);\r\n\t\tconstructor(...fields: Array<string|AbstractEnum>) {\r\n\t\t\tsuper(...fields);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t */\r\n\t\tpublic resolve(protocol: Array<IParamSignature>): Array<IParamSignature> { \r\n\r\n\t\t\tlet valids: Array<IParamSignature> = protocol.filter((param) => this.fields.indexOf(param.name) > -1 && param.resolved === true);\r\n\t\t\tif (valids.length >= this.fields.length) {\r\n\t\t\t\treturn protocol;\r\n\t\t\t}else {\r\n\t\t\t\treturn protocol.map((param) => {\r\n\t\t\t\t\tif (this.fields.indexOf(param.name) >  -1) {\r\n\t\t\t\t\t\tparam.payload = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn param;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}"],"sourceRoot":"/source/"}